<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compartilhar Artigo | Meme PMW</title>
  
  <!-- Meta tags dinâmicas que serão substituídas pelo script -->
  <meta property="og:title" content="Artigo | Meme PMW" />
  <meta property="og:description" content="Leia este artigo no Meme PMW" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://memepmw.online/logo.png" />
  <meta property="og:image:secure_url" content="https://memepmw.online/logo.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:site_name" content="Meme PMW" />
  <meta property="og:url" content="https://memepmw.online" />
  <meta property="og:locale" content="pt_BR" />
  
  <!-- Meta tags específicas para WhatsApp -->
  <meta property="og:image:alt" content="Imagem do artigo" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@memepmw" />
  <meta name="twitter:title" content="Artigo | Meme PMW" />
  <meta name="twitter:description" content="Leia este artigo no Meme PMW" />
  <meta name="twitter:image" content="https://memepmw.online/logo.png" />
  
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f5f5f5;
      text-align: center;
    }
    .container {
      max-width: 800px;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    h1 {
      color: #333;
      margin-bottom: 15px;
    }
    p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 25px;
    }
    .btn {
      display: inline-block;
      background-color: #6d28d9;
      color: white;
      text-decoration: none;
      padding: 12px 25px;
      border-radius: 5px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: #5b21b6;
    }
    .loading {
      margin-top: 20px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <img id="article-image" src="https://memepmw.online/logo.png" alt="Imagem do artigo">
    <h1 id="article-title">Carregando artigo...</h1>
    <p id="article-summary">Aguarde um momento enquanto carregamos o conteúdo do artigo.</p>
    <a href="#" id="article-link" class="btn">Ler artigo completo</a>
    <p class="loading">Você será redirecionado em <span id="countdown">5</span> segundos...</p>
  </div>

  <script>
    // Função para obter parâmetros da URL
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    // Função para buscar dados do artigo da API
    async function fetchArticle(id) {
      try {
        // Usar a API diretamente
        const apiUrl = 'https://memepmw.online/api';
        const response = await fetch(`${apiUrl}/articles/${id}`);
        
        if (!response.ok) {
          throw new Error(`Erro ao buscar artigo: ${response.status}`);
        }
        
        return await response.json();
      } catch (error) {
        console.error('Erro ao buscar artigo:', error);
        return null;
      }
    }

    // Função para processar URL de imagem
    function processImageUrl(imageUrl) {
      if (!imageUrl) return 'https://memepmw.online/logo.png';
      
      // Corrigir URLs com IP
      if (imageUrl.includes('167.172.152.174:3001')) {
        imageUrl = imageUrl.replace('http://167.172.152.174:3001', 'https://memepmw.online');
      }
      
      // Corrigir URLs relativas
      if (imageUrl.startsWith('/')) {
        imageUrl = `https://memepmw.online${imageUrl}`;
      }
      
      // Garantir HTTPS
      if (imageUrl.startsWith('http://')) {
        imageUrl = imageUrl.replace('http://', 'https://');
      }
      
      return imageUrl;
    }

    // Função para atualizar meta tags
    function updateMetaTags(title, description, image, url) {
      // OpenGraph
      document.querySelector('meta[property="og:title"]').setAttribute('content', title);
      document.querySelector('meta[property="og:description"]').setAttribute('content', description);
      document.querySelector('meta[property="og:image"]').setAttribute('content', image);
      document.querySelector('meta[property="og:image:secure_url"]').setAttribute('content', image);
      document.querySelector('meta[property="og:url"]').setAttribute('content', url);
      document.querySelector('meta[property="og:image:alt"]').setAttribute('content', title);
      
      // Twitter
      document.querySelector('meta[name="twitter:title"]').setAttribute('content', title);
      document.querySelector('meta[name="twitter:description"]').setAttribute('content', description);
      document.querySelector('meta[name="twitter:image"]').setAttribute('content', image);
      
      // Título da página
      document.title = title + ' | Meme PMW';
    }

    // Função principal
    async function init() {
      // Obter ID do artigo da URL
      const id = getUrlParameter('id');
      
      if (!id) {
        document.getElementById('article-title').textContent = 'Artigo não encontrado';
        document.getElementById('article-summary').textContent = 'O ID do artigo não foi fornecido.';
        return;
      }
      
      // Buscar dados do artigo
      const article = await fetchArticle(id);
      
      if (!article) {
        document.getElementById('article-title').textContent = 'Erro ao carregar artigo';
        document.getElementById('article-summary').textContent = 'Não foi possível carregar os dados do artigo.';
        return;
      }
      
      // Processar dados
      const title = article.title || 'Artigo | Meme PMW';
      const summary = article.summary || 'Leia este artigo no Meme PMW';
      const imageUrl = processImageUrl(article.featuredImage);
      const articleUrl = `https://memepmw.online/article/${id}`;
      
      // Atualizar elementos da página
      document.getElementById('article-title').textContent = title;
      document.getElementById('article-summary').textContent = summary;
      document.getElementById('article-image').src = imageUrl;
      document.getElementById('article-link').href = articleUrl;
      
      // Atualizar meta tags
      updateMetaTags(title, summary, imageUrl, articleUrl);
      
      // Iniciar contagem regressiva
      let countdown = 5;
      const countdownElement = document.getElementById('countdown');
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          window.location.href = articleUrl;
        }
      }, 1000);
    }

    // Iniciar quando a página carregar
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
